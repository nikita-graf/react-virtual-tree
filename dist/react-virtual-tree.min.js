!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):"object"==typeof exports?exports.ReactVirtualTree=t(require("react"),require("react-dom")):e.ReactVirtualTree=t(e.react,e["react-dom"])}(this,function(e,t){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(9);Object.defineProperty(t,"VirtualTree",{enumerable:!0,get:function(){return o(r)["default"]}});var i=n(4);Object.defineProperty(t,"buildTree",{enumerable:!0,get:function(){return o(i)["default"]}})},function(t,n){t.exports=e},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function r(e){n(this,r),this.component=e};t["default"]=o},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(2),u=o(s),c=function(e){function t(){return r(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),a(t,[{key:"init",value:function(e){e()}},{key:"getItemHeight",value:function(){return this.component.props.itemHeight}},{key:"getVisibleNodesCount",value:function(){var e=this.component.props.itemHeight,t=this.component.state.height;return Math.ceil(t/e)+1}},{key:"getRawNodeIndexAtPosition",value:function(e){var t=this.component.props.itemHeight;return Math.floor(e/t)}},{key:"getScrollHeight",value:function(){var e=this.component.props.itemHeight,t=this.component.state.nodes;return e*t.length}},{key:"getPositionByItemIndex",value:function(e){var t=this.component.props.itemHeight;return t*e}}]),t}(u["default"]);t["default"]=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=o(r);t["default"]=function(e){var t=e.items,n=e.levels,o=e.filter,r=void 0===o?function(){return!0}:o,l=[],a=new i["default"](t,n,r);return a.traverse(function(e){l.push(e)}),l}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=1,i=function(){function e(t,o,i){n(this,e),this.id=r++,this.level=i||0,this.key=t,this.data=o,this.keyValueGetterName="string"==typeof t?"stringKeyValueGetter":"arrayKeyValueGetter",this.clear()}return o(e,[{key:"addChild",value:function(e){var t=e.getKeyValue(),n=this.childrenKeys[t];return n?n:(this.childrenKeys[t]=e,this.children.push(e),e.parent=this,void 0)}},{key:"stringKeyValueGetter",value:function(){return this.data[this.key]}},{key:"arrayKeyValueGetter",value:function(){for(var e="",t=0,n=this.key.length;n>t;t++)e+=this.data[this.key[t]];return e}},{key:"getKeyValue",value:function(){return this[this.keyValueGetterName]()}},{key:"sort",value:function(e){this.children.sort(e)}},{key:"getChildByKey",value:function(e){return this.childrenKeys[e]}},{key:"clear",value:function(){this.children=[],this.childrenKeys={}}},{key:"isLeaf",value:function(){return!this.children.length}},{key:"traverseRoot",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this:arguments[1],n=this.parent;n&&(e(n,t),n.traverseRoot(e,t))}},{key:"traverse",value:function(e){this.data&&e(this),this.children.length&&this.children.forEach(function(t){t.traverse(e)})}}]),e}();t["default"]=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.sortAlphabetic=function(e,t){var n=e.getKeyValue().toLowerCase(),o=t.getKeyValue().toLowerCase();return o>n?-1:n>o?1:0},t.sortNumeric=function(e,t){return e.getKeyValue()-t.getKeyValue()}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),s=o(a),u=n(6),c=function(e){function t(e,n,o){r(this,t);var l=i(this,Object.getPrototypeOf(t).call(this)),a=l,c=void 0,d=void 0,f=void 0,h=e.length,p=n.length,v=void 0,y=void 0,_=void 0,g=void 0,b=n.map(function(e){return"function"==typeof e.sort?e.sort:u.sortNumeric});for(d=0;h>d;d++)if(g=e[d],c=a,o(g))for(f=0;p>f;f++)v=n[f],y=new s["default"](v.key,g,c.level+1),_=c.getChildByKey(y.getKeyValue()),_||(_=y,c.addChild(_),c.sort(b[f])),c=_;return l}return l(t,e),t}(s["default"]);t["default"]=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(1),u=o(s),c="virtual-tree-node",d=function(e){function t(){var e,n,o,l;r(this,t);for(var a=arguments.length,s=Array(a),u=0;a>u;u++)s[u]=arguments[u];return n=o=i(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),o.toggleCollapse=function(){var e=o.props.collapsed;o.props[e?"onExpand":"onCollapse"]()},l=n,i(o,l)}return l(t,e),a(t,[{key:"render",value:function(){var e=this.props,t=e.node,n=e.collapsed,o=e.renderContent,r=t.isLeaf(),i=r?c+"_leaf":"",l=n?c+"_collapsed":"",a=c+" "+i+" "+l,s={paddingLeft:10*(t.level-1)+"px"},d=void 0;return r||(d=u["default"].createElement("span",{className:"virtual-tree-node__arrow",onClick:this.toggleCollapse})),u["default"].createElement("div",{className:a,style:s},d,o(t))}}]),t}(s.Component);t["default"]=d},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1),c=o(u),d=n(10),f=n(8),h=o(f),p=n(3),v=o(p),y=function(e){function t(e){r(this,t);var n=e.itemHeight,o=i(this,Object.getPrototypeOf(t).call(this,e));return o._updateViewport=function(){o.setState({height:o.scrollContainer.innerHeight,width:o.element.offsetWidth})},o.collapseNode=function(e,t){var n=o.state.nodes,r=o._countChildrenAfterIndex(t);o._collapsedNodes[e.id]=!0,o._nodeToHiddenChilds[e.id]=n.splice(t+1,r),o._updateScrollHeight()},o.expandNode=function(e,t){var n=o.state.nodes,r=o._nodeToHiddenChilds[e.id].slice(0);r.unshift(0),r.unshift(t+1),n.splice.apply(n,r),o._nodeToHiddenChilds[e.id]=null,o._collapsedNodes[e.id]=!1,o._updateScrollHeight()},o.state={height:0,width:0,position:0,nodes:e.nodes},o._reset(),o._helper="function"==typeof n?new v["default"](o):new v["default"](o),o}return l(t,e),s(t,[{key:"componentWillMount",value:function(){var e=this;this._helper.init(function(){e._updateScrollHeight()})}},{key:"componentDidMount",value:function(){var e=this,t=(0,d.findDOMNode)(this),n=void 0;this.props.scrollContainer?(this.scrollContainer=t,n=function(){var t=e.scrollContainer.pageYOffset;e.setState({position:e._normalizeScrollPosition(t)})}):(this.scrollContainer=window,n=function(){var n=t.getBoundingClientRect().top+window.pageYOffset-document.documentElement.clientTop,o=window.pageYOffset||document.documentElement.scrollTop,r=o-n;e.setState({position:e._normalizeScrollPosition(r)})}),this.element=t,window.addEventListener("resize",this._updateViewport),this.scrollContainer.addEventListener("scroll",n),this.unbind=function(){window.removeEventListener("resize",e._updateViewport),e.scrollContainer.removeEventListener("scroll",n)},this._updateViewport(),this._updateScrollHeight(),setTimeout(function(){e._updateViewport(),e._updateScrollHeight()},0),this.props.collapsed&&this.collapseAll()}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.nodes,o=e.nodes;o!==n&&(this._reset(),this.setState({nodes:o.slice(0)},function(){t._helper.init(function(){t._updateScrollHeight()}),t.props.collapsed&&t.collapseAll()}))}},{key:"componentWillUnmount",value:function(){this.unbind()}},{key:"_reset",value:function(){this._nodeToHiddenChilds={},this._collapsedNodes={}}},{key:"_renderNode",value:function(e){var t=this.props,n=t.renderNode,o=t.renderContent;return n?n(e):c["default"].createElement(h["default"],a({renderContent:o},e))}},{key:"_normalizeScrollPosition",value:function(e){var t=this.state.scrollHeight;return 0>e?e=0:e>t&&(e=t),Math.round(e)}},{key:"_updateScrollHeight",value:function(){this.setState({scrollHeight:this._helper.getScrollHeight()})}},{key:"_getNodeIndexAtPosition",value:function(e){var t=this._helper.getRawNodeIndexAtPosition(e);return this._normalizeNodeIndex(t)}},{key:"_normalizeNodeIndex",value:function(e){return e=Math.min(this.state.nodes.length-1,e),e=Math.max(0,e)}},{key:"_countChildrenAfterIndex",value:function(e){for(var t=this.state.nodes,n=t[e],o=void 0,r=0,i=e+1;i<t.length&&(o=t[i],!(o.level<=n.level));i++)r++;return r}},{key:"collapseAll",value:function(){var e=this,t=this.state.nodes,n=void 0;if(t.length){n=t[0].parent.children.slice(0);for(var o in this._nodeToHiddenChilds){var r=this._nodeToHiddenChilds[o];r&&(this._nodeToHiddenChilds[o]=t[0].parent.children.slice(0),r.forEach(function(t){t.children&&(e._collapsedNodes[t.id]=!0,e._nodeToHiddenChilds[t.id]=t.children.slice(0))}))}for(var i=t.length-1;i>=0;i--){var l=t[i];this._collapsedNodes[l.id]=!0,l.children.length&&(this._nodeToHiddenChilds[l.id]=l.children.slice(0))}t.length=0,n.forEach(function(e){return t.push(e)}),this._updateScrollHeight()}}},{key:"expandAll",value:function(){for(var e=this,t=this.state.nodes,n=function r(n,o){var i=e._nodeToHiddenChilds[n.id],l=o+1;if(e._nodeToHiddenChilds[n.id]=null,e._collapsedNodes[n.id]=!1,i){var a=t.slice(l),s=a.length;t.length-=s;for(var u=i.length-1;u>=0;u--){var c=i[u];e._collapsedNodes[n.id]=!1,t[l+u]=c,c.children.length&&r(c,l+u)}for(var d=t.length,f=0;s>f;f++)t[d+f]=a[f]}},o=t.length-1;o>=0;o--)n(t[o],o);this._updateScrollHeight()}},{key:"_getPlaceholderHeight",value:function(){var e=this.state,t=e.scrollHeight,n=e.position,o=this.scrollContainer?this.scrollContainer.innerHeight:0,r=n>0?0:-o;return t>o?t+r:0}},{key:"_getPlaceholderStyle",value:function(){return{height:this._getPlaceholderHeight()+"px"}}},{key:"_getContainerStyle",value:function(e,t){var n=this.state.width,o=this.props.containerPosition,r=void 0===o?"fixed":o;return e>0?{position:r,top:-t+"px",width:n+"px"}:{position:"static",top:"auto",width:"auto"}}},{key:"render",value:function(){for(var e=this.state,t=e.position,n=e.nodes,o=this._normalizeNodeIndex(this._getNodeIndexAtPosition(t)),r=this._helper.getPositionByItemIndex(o),i=t-r,l=this._helper.getVisibleNodesCount(o,i),a=this._normalizeNodeIndex(o+l),s=[],u=o;a>=u;u++){var d=n[u];s.push(c["default"].createElement("li",{className:"virtual-tree__node-container",key:d.id,style:{height:this._helper.getItemHeight(d)}},this._renderNode({node:d,collapsed:this._collapsedNodes[d.id],onCollapse:this.collapseNode.bind(this,d,u),onExpand:this.expandNode.bind(this,d,u)})))}return c["default"].createElement("div",{className:"virtual-tree"},c["default"].createElement("ul",{className:"virtual-tree__container",style:this._getContainerStyle(t,i)},s),c["default"].createElement("div",{className:"virtual-tree__placeholder",style:this._getPlaceholderStyle()}))}}]),t}(u.Component);t["default"]=y},function(e,n){e.exports=t}])});